<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¯Ø±Ø³Ø© - Ø§Ù„ØªÙ†Ø³ÙŠÙ‚</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.7.2/dist/full.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    
    <style>
        html, body { max-width: 100vw; overflow-x: hidden; }
        body { font-family: 'Cairo', sans-serif; background-color: #141A32; min-height: 100vh; color: #E8EDEB; padding-bottom: 20px; transition: background-color 0.4s, color 0.4s; }
        .glass-panel { background: rgba(20, 26, 50, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(214, 140, 41, 0.3); border-radius: 1.5rem; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5); }
        .input-light { background-color: #ffffff !important; color: #1e293b !important; border: 2px solid #cbd5e1; font-weight: 800; transition: all 0.3s ease;}
        .input-light:focus { border-color: #D68C29; outline: none; box-shadow: 0 0 0 3px rgba(214, 140, 41, 0.3); }
        .input-readonly { background-color: #f1f5f9 !important; color: #64748b !important; border: 1px solid #e2e8f0; cursor: not-allowed; font-weight: 900 !important; }
        label { font-size: 0.85rem; font-weight: bold; color: #D68C29; margin-bottom: 0.4rem; display: block; }
        .btn-gold { background: linear-gradient(135deg, #D68C29 0%, #B4731D 100%); color: white; border: none; box-shadow: 0 5px 15px rgba(214, 140, 41, 0.3); transition: all 0.3s;}
        .btn-gold:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(214, 140, 41, 0.5); }
        
        .main-card { background: linear-gradient(145deg, rgba(30,41,59,0.9), rgba(15,23,42,0.9)); border: 2px solid rgba(255,255,255,0.05); border-radius: 20px; padding: 20px 15px; text-align: center; cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 10px; box-shadow: 0 10px 20px rgba(0,0,0,0.3);}
        .main-card:hover { transform: translateY(-8px); border-color: #D68C29; box-shadow: 0 15px 30px rgba(214, 140, 41, 0.2); background: linear-gradient(145deg, rgba(30,41,59,1), rgba(20,26,50,1));}
        .icon-wrapper { width: 55px; height: 55px; border-radius: 15px; background: rgba(214, 140, 41, 0.1); display: flex; align-items: center; justify-content: center; color: #F5C678; transition: all 0.3s; }
        .main-card:hover .icon-wrapper { background: #D68C29; color: #141A32; transform: scale(1.1); }
        
        .home-btn { display: inline-flex; align-items: center; gap: 8px; background: rgba(255,255,255,0.1); color: white; padding: 8px 20px; border-radius: 12px; font-weight: bold; border: 1px solid rgba(255,255,255,0.2); transition: all 0.3s; margin-bottom: 20px; text-decoration: none;}
        .home-btn:hover { background: #D68C29; border-color: #D68C29; color: #141A32; box-shadow: 0 5px 15px rgba(214, 140, 41, 0.4); transform: translateX(-5px);}
        
        .avatar-upload-wrapper { position: relative; width: 100px; height: 100px; margin: 0 auto; border-radius: 1rem; overflow: hidden; border: 3px solid #D68C29; cursor: pointer; box-shadow: 0 5px 15px rgba(0,0,0,0.3);}
        .avatar-upload-wrapper img { width: 100%; height: 100%; object-fit: cover; background: #fff;}
        .avatar-upload-overlay { position: absolute; bottom: 0; left: 0; right: 0; background: rgba(0,0,0,0.7); color: white; font-size: 12px; font-weight: bold; padding: 6px 0; text-align: center; opacity: 0; transition: 0.3s;}
        .avatar-upload-wrapper:hover .avatar-upload-overlay { opacity: 1; }

        .stepper-container { position: relative; display: flex; justify-content: space-between; align-items: center; margin-top: 10px; margin-bottom: 10px; padding: 0 10px;}
        .stepper-line-bg { position: absolute; top: 16px; left: 20px; right: 20px; height: 4px; background-color: rgba(255,255,255,0.1); z-index: 1; border-radius: 4px; }
        .stepper-line-fill { position: absolute; top: 16px; right: 20px; height: 4px; background-color: #10B981; z-index: 2; border-radius: 4px; transition: width 1s ease-in-out; }
        .step-item { position: relative; z-index: 3; display: flex; flex-direction: column; align-items: center; gap: 8px; width: 25%;}
        .step-circle { width: 35px; height: 35px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-weight: 900; font-size: 14px; transition: all 0.5s ease; border: 4px solid #141A32; box-shadow: 0 0 10px rgba(0,0,0,0.5);}
        .step-circle.active { background-color: #10B981; color: white; }
        .step-circle.inactive { background-color: #334155; color: #94a3b8; }
        
        body.light-theme { background-color: #f1f5f9; color: #0f172a; }
        body.light-theme .glass-panel, body.light-theme .bg-\[\#141A32\], body.light-theme .bg-black\/30, body.light-theme .bg-black\/20 { background: #ffffff !important; border-color: #cbd5e1 !important; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        body.light-theme .main-card { background: #ffffff; border-color: #cbd5e1; }
        body.light-theme .main-card:hover { background: #f8fafc; border-color: #D68C29; }
        body.light-theme h2, body.light-theme h3, body.light-theme h4, body.light-theme .text-white { color: #0f172a !important; }
        body.light-theme .text-slate-400, body.light-theme .text-slate-500 { color: #475569 !important; font-weight: bold; }
        body.light-theme .text-\[\#F5C678\] { color: #b45309 !important; }
        body.light-theme .bg-\[\#0B0F1E\] { background: #f8fafc !important; border-color: #cbd5e1 !important; }
        body.light-theme .home-btn { background: #e2e8f0; color: #0f172a; border-color: #cbd5e1; }
        body.light-theme .step-circle { border-color: #ffffff; }
        body.light-theme .stepper-line-bg { background-color: #e2e8f0; }
        body.light-theme table { color: #0f172a; } body.light-theme th { color: #475569; } body.light-theme tr { border-color: #cbd5e1 !important; }
        
        .theme-toggle-btn { position: fixed; top: 85px; left: 20px; z-index: 50; background: white; width: 45px; height: 45px; border-radius: 12px; display: flex; align-items: center; justify-content: center; box-shadow: 0 5px 15px rgba(0,0,0,0.2); transition: all 0.3s ease; border: 2px solid #D68C29; color: #F5C678; font-size: 1.3rem;}
        body.light-theme .theme-toggle-btn { background: #141A32; border-color: #cbd5e1; color: #b45309; }

        @media print {
            body * { visibility: hidden; }
            #printArea, #printArea * { visibility: visible; }
            #printArea { position: absolute; left: 0; top: 0; width: 100%; direction: rtl; background: white; color: black; padding: 20px; font-family: 'Times New Roman', serif;}
            .print-hidden { display: none !important; }
            .print-border { border: 1px solid #000; padding: 8px; border-collapse: collapse; }
        }

        .custom-scrollbar::-webkit-scrollbar { width: 6px; height: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: rgba(255,255,255,0.05); border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #D68C29; border-radius: 10px; }
        [x-cloak] { display: none !important; }
    </style>
</head>

<body x-data="madrasaApp()" x-init="initApp()">

    <button @click="toggleTheme()" class="theme-toggle-btn print-hidden" title="ØªØºÙŠÙŠØ± Ø§Ù„Ø¥Ø¶Ø§Ø¡Ø©">
        <span x-show="!isLightMode">â˜€ï¸</span><span x-show="isLightMode" x-cloak>ğŸŒ™</span>
    </button>

    <div x-show="alertModal.show" class="fixed inset-0 z-[99999] flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 print-hidden" x-cloak x-transition><div class="bg-white w-full max-w-sm p-8 rounded-3xl shadow-2xl text-center transform transition-all" :class="alertModal.type === 'success' ? 'border-t-8 border-green-500' : 'border-t-8 border-red-500'"><div class="text-6xl mb-4" x-text="alertModal.type === 'success' ? 'âœ…' : 'âš ï¸'"></div><h3 class="text-2xl font-black text-slate-800 mb-2" x-text="alertModal.title"></h3><p class="text-slate-600 font-bold mb-6 text-sm" x-text="alertModal.message"></p><button @click="closeAlert()" :class="`btn w-full text-white font-black text-lg h-12 rounded-xl border-none ${alertModal.type === 'success' ? 'bg-green-500 hover:bg-green-600' : 'bg-red-500 hover:bg-red-600'}`">Ø­Ø³Ù†Ø§Ù‹</button></div></div>
    
    <div x-show="showOathModal" class="fixed inset-0 z-[100000] flex items-center justify-center bg-black/90 backdrop-blur-md p-4 print-hidden" x-cloak x-transition><div class="bg-[#141A32] w-full max-w-md p-8 rounded-3xl shadow-[0_0_40px_rgba(214,140,41,0.3)] border border-[#D68C29]/50 text-center relative overflow-hidden"><div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-red-500 via-yellow-500 to-red-500"></div><div class="w-20 h-20 bg-red-500/10 rounded-2xl flex items-center justify-center mx-auto mb-4 border-2 border-red-500/50 text-4xl">âš–ï¸</div><h3 class="text-2xl font-black text-white mb-4">Ø¥Ù‚Ø±Ø§Ø± Ù‚Ø§Ù†ÙˆÙ†ÙŠ</h3><div class="bg-black/40 p-5 rounded-xl border border-white/10 mb-6"><p class="text-slate-300 font-bold leading-loose text-sm md:text-base">"Ø£ØªØ¹Ù‡Ø¯ Ø£Ù†Ø§ <span class="text-[#F5C678] font-black mx-1" x-text="formData.full_name"></span> Ø¨Ø£Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙØ¯Ø®Ù„Ø© ÙˆØ§Ù„Ù…Ø­ÙÙˆØ¸Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¬Ù„ ØµØ­ÙŠØ­Ø© ÙˆØ¯Ù‚ÙŠÙ‚Ø©ØŒ ÙˆØ¹Ù„Ù‰ Ù…Ø³Ø¦ÙˆÙ„ÙŠØªÙŠ Ø§Ù„Ø´Ø®ØµÙŠØ©."</p></div><div class="flex gap-3"><button @click="confirmAndSave()" class="btn flex-1 bg-green-600 hover:bg-green-700 text-white font-black text-lg h-14 rounded-xl border-none shadow-lg">Ø£ÙˆØ§ÙÙ‚ ÙˆØ£ØªØ¹Ù‡Ø¯ âœ…</button><button @click="showOathModal = false" class="btn bg-slate-700 hover:bg-slate-600 text-white font-black text-lg h-14 rounded-xl border-none">ØªØ±Ø§Ø¬Ø¹ âŒ</button></div></div></div>

    <div class="w-full p-4 flex justify-between items-center bg-[#141A32]/90 backdrop-blur sticky top-0 z-40 border-b border-[#D68C29]/30 shadow-lg print-hidden">
        <div><p class="text-xs text-slate-400">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ù…Ø¯Ø±Ø³Ø©:</p><h1 class="text-xl md:text-2xl font-black text-[#D68C29]" x-text="school.name || 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...'"></h1></div>
        <div class="text-left">
            <span class="badge bg-slate-700 text-white border-none text-xs mb-1 px-3 py-2 rounded-lg" x-text="currentUser?.role === 'manager' ? 'ğŸ‘‘ Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©' : 'ğŸ‘¨â€ğŸ« ÙˆÙƒÙŠÙ„'"></span>
            <button @click="logout" class="block text-red-400 font-bold text-sm hover:text-red-300 w-full text-left mt-1">Ø®Ø±ÙˆØ¬ ğŸšª</button>
        </div>
    </div>

    <div class="p-4 max-w-5xl mx-auto min-h-[80vh] mt-4 relative print-hidden">

        <div x-show="currentView === 'menu'" x-transition.opacity x-cloak>
            
            <div x-show="currentUser?.role === 'manager'" class="glass-panel p-4 md:p-6 mb-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-white font-black text-sm md:text-lg">Ù…Ø¹Ø¯Ù„ Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ</h3>
                    <span class="badge rounded-lg" :class="progressPercentage === 100 ? 'bg-green-500 text-white border-none' : 'bg-slate-700 text-white border-none'" x-text="`${Math.round(progressPercentage)}%`"></span>
                </div>
                
                <div class="stepper-container">
                    <div class="stepper-line-bg"></div>
                    <div class="stepper-line-fill" :style="`width: ${progressLine}%`"></div>
                    
                    <div class="step-item"><div class="step-circle" :class="isManagerComplete ? 'active' : 'inactive'"><span x-show="isManagerComplete">âœ“</span><span x-show="!isManagerComplete">1</span></div><span class="text-[10px] md:text-xs font-bold text-center" :class="isManagerComplete ? 'text-green-500' : 'text-slate-400'">Ø§Ù„Ù…Ø¯ÙŠØ±</span></div>
                    <div class="step-item"><div class="step-circle" :class="isAgentsComplete ? 'active' : 'inactive'"><span x-show="isAgentsComplete">âœ“</span><span x-show="!isAgentsComplete">2</span></div><span class="text-[10px] md:text-xs font-bold text-center" :class="isAgentsComplete ? 'text-green-500' : 'text-slate-400'">Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡</span></div>
                    <div class="step-item"><div class="step-circle" :class="isTeachersComplete ? 'active' : 'inactive'"><span x-show="isTeachersComplete">âœ“</span><span x-show="!isTeachersComplete">3</span></div><span class="text-[10px] md:text-xs font-bold text-center" :class="isTeachersComplete ? 'text-green-500' : 'text-slate-400'">Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†</span></div>
                    <div class="step-item"><div class="step-circle" :class="isStatsComplete ? 'active' : 'inactive'"><span x-show="isStatsComplete">âœ“</span><span x-show="!isStatsComplete">4</span></div><span class="text-[10px] md:text-xs font-bold text-center" :class="isStatsComplete ? 'text-green-500' : 'text-slate-400'">Ø§Ù„Ø¥Ø­ØµØ§Ø¡</span></div>
                </div>
            </div>

            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-2">
                <div x-show="currentUser?.role === 'manager'" @click="openManagerView()" class="main-card relative">
                    <span x-show="!isManagerComplete" class="absolute top-3 right-3 flex h-4 w-4"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span><span class="relative inline-flex rounded-full h-4 w-4 bg-red-500"></span></span>
                    <div class="icon-wrapper"><svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg></div>
                    <div><h2 class="text-lg font-black text-white">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯ÙŠØ±</h2><p class="text-[10px] text-slate-400 mt-1">Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</p></div>
                </div>
                
                <div x-show="currentUser?.role === 'manager'" @click="currentView = 'agents'" class="main-card">
                    <div class="icon-wrapper"><svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg></div>
                    <div><h2 class="text-lg font-black text-white">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡</h2><p class="text-[10px] text-slate-400 mt-1">Ø¥Ø¶Ø§ÙØ© ÙˆØ­Ø°Ù Ø¨Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„</p></div>
                </div>

                <div x-show="currentUser?.role === 'manager'" @click="currentView = 'agent_records'" class="main-card bg-gradient-to-br from-cyan-900/50 to-[#141A32]">
                    <div class="icon-wrapper !bg-cyan-500/20 !text-cyan-400"><svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg></div>
                    <div><h2 class="text-lg font-black text-cyan-400">Ù…Ù„ÙØ§Øª Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡</h2><p class="text-[10px] text-slate-400 mt-1">Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</p></div>
                </div>
                
                <div x-show="currentUser?.role === 'agent'" @click="openAgentProfile()" class="main-card relative">
                    <span x-show="!currentUser?.full_name || currentUser?.full_name === 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ø³ØªÙƒÙ…Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª'" class="absolute top-3 right-3 flex h-4 w-4"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span><span class="relative inline-flex rounded-full h-4 w-4 bg-red-500"></span></span>
                    <div class="icon-wrapper"><svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg></div>
                    <div><h2 class="text-lg font-black text-white">Ø¨ÙŠØ§Ù†Ø§ØªÙŠ Ø§Ù„ÙˆØ¸ÙŠÙÙŠØ©</h2><p class="text-[10px] text-slate-400 mt-1">ØªØ­Ø¯ÙŠØ« Ø³Ø¬Ù„ÙŠ</p></div>
                </div>

                <div x-show="currentUser?.role === 'manager'" @click="currentView = 'teachers_stats'" class="main-card relative bg-gradient-to-br from-amber-900/50 to-[#141A32]">
                    <span x-show="!isTeachersComplete" class="absolute top-3 right-3 flex h-4 w-4"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span><span class="relative inline-flex rounded-full h-4 w-4 bg-red-500"></span></span>
                    <div class="icon-wrapper !bg-amber-500/20 !text-amber-400"><svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path></svg></div>
                    <div><h2 class="text-lg font-black text-amber-400">Ø¥Ø­ØµØ§Ø¡ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†</h2><p class="text-[10px] text-slate-400 mt-1">Ø¹Ø¬Ø² ÙˆØ²ÙŠØ§Ø¯Ø© Ø§Ù„Ù…ÙˆØ§Ø¯</p></div>
                </div>

                <div @click="openStatistics()" class="main-card relative">
                    <span x-show="currentUser?.role === 'manager' && !isStatsComplete" class="absolute top-3 right-3 flex h-4 w-4"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span><span class="relative inline-flex rounded-full h-4 w-4 bg-red-500"></span></span>
                    <div class="icon-wrapper"><svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg></div>
                    <div><h2 class="text-lg font-black text-white">Ø§Ù„Ø¥Ø­ØµØ§Ø¡ Ø§Ù„Ø´Ø§Ù…Ù„</h2><p class="text-[10px] text-slate-400 mt-1">Ù‚ÙˆØ© Ø§Ù„Ø¹Ù…Ù„ ÙˆØ§Ù„Ø·Ù„Ø§Ø¨</p></div>
                </div>

                <div @click="currentView = 'messages'" class="main-card relative">
                    <span x-show="schoolMessages.length > 0" class="absolute top-3 right-3 bg-red-500 text-white text-[10px] font-bold w-5 h-5 flex items-center justify-center rounded-lg animate-pulse shadow-lg border border-white" x-text="schoolMessages.length"></span>
                    <div class="icon-wrapper"><svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg></div>
                    <div><h2 class="text-lg font-black text-white">Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„ÙˆØ§Ø±Ø¯Ø©</h2><p class="text-[10px] text-slate-400 mt-1">ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø±Ø§Ø³Ù„Ø§Øª</p></div>
                </div>

                <div @click="window.location.href = `activities.html?uid=${currentUser.mobile}`" class="main-card bg-gradient-to-br from-green-900/40 to-[#141A32] border-green-500/30 hover:border-green-400">
                    <div class="icon-wrapper !bg-green-500/20 !text-green-400">
                        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"></path></svg>
                    </div>
                    <div>
                        <h2 class="text-lg font-black text-green-400">Ø§Ù„Ù†Ø´Ø§Ø· ÙˆØ§Ù„ØªÙƒØ±ÙŠÙ…</h2>
                        <p class="text-[10px] text-slate-400 mt-1">Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª ÙˆØ³Ø¬Ù„ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª</p>
                    </div>
                </div>

                <div @click="currentView = 'requests'" class="main-card md:col-span-2">
                    <div class="icon-wrapper"><svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg></div>
                    <div><h2 class="text-lg font-black text-white">Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ù„Ù„ØªÙ†Ø³ÙŠÙ‚</h2><p class="text-[10px] text-slate-400 mt-1">Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª ÙˆØ§Ù„Ø¥Ù‚Ø±Ø§Ø±Ø§Øª</p></div>
                </div>
            </div>
        </div>

        <div x-show="currentView === 'teachers_stats'" x-transition x-cloak>
            <div class="flex justify-between items-center mb-4">
                <button @click="currentView = 'menu'" class="home-btn mb-0"><svg class="w-5 h-5 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
                <button @click="saveSubjectsStats()" x-show="currentUser?.role === 'manager'" class="btn btn-sm btn-success text-white border-none shadow-md rounded-lg">
                    <span x-show="!loading">Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ğŸ’¾</span><span x-show="loading" class="loading loading-spinner loading-xs"></span>
                </button>
            </div>
            
            <div class="glass-panel p-4 md:p-6 border-t-4 border-t-amber-500 overflow-hidden">
                <h2 class="text-xl md:text-2xl font-black text-white text-center mb-6">ğŸ‘¨â€ğŸ« Ø¥Ø­ØµØ§Ø¡ Ù…Ø¹Ù„Ù…ÙŠ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</h2>
                <div class="overflow-x-auto custom-scrollbar pb-2 bg-black/20 rounded-xl border border-white/10">
                    <table class="table w-full text-center text-xs md:text-sm">
                        <thead>
                            <tr class="text-slate-300 border-b border-white/10 whitespace-nowrap">
                                <th class="bg-black/10">Ø§Ù„Ù…Ø§Ø¯Ø©</th>
                                <th>Ø£ØµÙ„ÙŠ</th>
                                <th>Ù…Ù†ØªØ¯Ø¨ (ÙƒÙ„ÙŠ/Ø¬Ø²Ø¦ÙŠ)</th>
                                <th>Ø¨Ø§Ù„Ø­ØµØ©</th>
                                <th class="text-red-400">Ø§Ù„Ø¹Ø¬Ø²</th>
                                <th class="text-green-400">Ø§Ù„Ø²ÙŠØ§Ø¯Ø©</th>
                            </tr>
                        </thead>
                        <tbody>
                            <template x-for="key in ['arabic', 'english', 'social', 'math', 'science']" :key="key">
                                <tr class="border-b border-white/5 hover:bg-white/5 transition-colors">
                                    <td class="font-bold text-[#F5C678] bg-black/10 whitespace-nowrap" x-text="school.subjects_stats[key].name"></td>
                                    <td><input type="number" min="0" onkeypress="return event.charCode >= 48 && event.charCode <= 57" x-model="school.subjects_stats[key].original" class="input input-xs w-14 md:w-20 input-light text-center rounded-lg" :disabled="currentUser?.role !== 'manager'"></td>
                                    <td><input type="number" min="0" onkeypress="return event.charCode >= 48 && event.charCode <= 57" x-model="school.subjects_stats[key].delegated" class="input input-xs w-14 md:w-20 input-light text-center rounded-lg" :disabled="currentUser?.role !== 'manager'"></td>
                                    <td><input type="number" min="0" onkeypress="return event.charCode >= 48 && event.charCode <= 57" x-model="school.subjects_stats[key].session" class="input input-xs w-14 md:w-20 input-light text-center rounded-lg" :disabled="currentUser?.role !== 'manager'"></td>
                                    <td><input type="number" min="0" onkeypress="return event.charCode >= 48 && event.charCode <= 57" x-model="school.subjects_stats[key].deficit" class="input input-xs w-14 md:w-20 input-light text-center rounded-lg text-red-600 font-bold bg-red-50" :disabled="currentUser?.role !== 'manager'"></td>
                                    <td><input type="number" min="0" onkeypress="return event.charCode >= 48 && event.charCode <= 57" x-model="school.subjects_stats[key].surplus" class="input input-xs w-14 md:w-20 input-light text-center rounded-lg text-green-600 font-bold bg-green-50" :disabled="currentUser?.role !== 'manager'"></td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div x-show="currentView === 'statistics'" x-transition x-cloak>
            <div class="flex justify-between items-center mb-4">
                <button @click="currentView = 'menu'" class="home-btn mb-0"><svg class="w-5 h-5 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
                <button @click="exportStatsToAdmin" x-show="currentUser?.role === 'manager'" class="btn btn-sm btn-success text-white border-none shadow-md rounded-lg">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø­ØµØ§Ø¡ Ù„Ù„ØªÙ†Ø³ÙŠÙ‚ ğŸ“¤</button>
            </div>
            
            <div class="glass-panel p-4 md:p-6 border-t-4 border-t-teal-500">
                <h2 class="text-2xl font-black text-white text-center mb-6">ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø´Ø§Ù…Ù„Ø©</h2>
                
                <div class="space-y-6 mb-8">
                    <div class="bg-black/20 p-5 rounded-2xl border border-white/10">
                        <h3 class="text-teal-400 font-bold border-b border-white/10 pb-2 mb-4">Ø£Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø¹Ø§Ù…Ø©</h3>
                        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3">
                            <div><label class="text-indigo-400 text-xs font-bold block mb-1">Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†</label><input type="number" min="0" onkeypress="return event.charCode >= 48 && event.charCode <= 57" x-model="school.teachers_count" @input="debouncedRenderCharts()" class="input w-full input-light rounded-xl text-center font-black" :disabled="currentUser?.role !== 'manager'"></div>
                            <div><label class="text-teal-400 text-xs font-bold block mb-1">Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠÙŠÙ†</label><input type="number" min="0" onkeypress="return event.charCode >= 48 && event.charCode <= 57" x-model="school.admins_count" @input="debouncedRenderCharts()" class="input w-full input-light rounded-xl text-center font-black" :disabled="currentUser?.role !== 'manager'"></div>
                            <div><label class="text-amber-400 text-xs font-bold block mb-1">Ø§Ù„Ø¹Ù…Ø§Ù„</label><input type="number" min="0" onkeypress="return event.charCode >= 48 && event.charCode <= 57" x-model="school.workers_count" @input="debouncedRenderCharts()" class="input w-full input-light rounded-xl text-center font-black" :disabled="currentUser?.role !== 'manager'"></div>
                            <div><label class="text-purple-400 text-xs font-bold block mb-1">Ø§Ù„ÙØµÙˆÙ„</label><input type="number" min="0" onkeypress="return event.charCode >= 48 && event.charCode <= 57" x-model="school.classrooms_count" class="input w-full input-light rounded-xl text-center font-black" :disabled="currentUser?.role !== 'manager'"></div>
                            <div><label class="text-blue-400 text-xs font-bold block mb-1">Ø§Ù„Ø¨Ù†ÙŠÙ†</label><input type="number" min="0" onkeypress="return event.charCode >= 48 && event.charCode <= 57" x-model="school.students_count" @input="debouncedRenderCharts()" class="input w-full input-light rounded-xl text-center font-black" :disabled="currentUser?.role !== 'manager'"></div>
                            <div><label class="text-pink-400 text-xs font-bold block mb-1">Ø§Ù„Ø¨Ù†Ø§Øª</label><input type="number" min="0" onkeypress="return event.charCode >= 48 && event.charCode <= 57" x-model="school.female_students_count" @input="debouncedRenderCharts()" class="input w-full input-light rounded-xl text-center font-black" :disabled="currentUser?.role !== 'manager'"></div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-white/5 p-4 rounded-2xl border border-white/10 flex flex-col items-center justify-center h-[250px] w-full">
                            <h4 class="text-sm font-bold text-slate-300 mb-2">ØªÙˆØ²ÙŠØ¹ Ù‚ÙˆØ© Ø§Ù„Ø¹Ù…Ù„</h4>
                            <div class="w-full max-w-[200px] h-full relative flex items-center justify-center"><canvas id="staffChart"></canvas></div>
                        </div>
                        <div class="bg-white/5 p-4 rounded-2xl border border-white/10 flex flex-col items-center justify-center h-[250px] w-full">
                            <h4 class="text-sm font-bold text-slate-300 mb-2">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨</h4>
                            <div class="w-full max-w-[200px] h-full relative flex items-center justify-center"><canvas id="studentChart"></canvas></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div x-show="currentView === 'agent_records'" x-transition x-cloak>
            <div class="flex justify-between items-center mb-4">
                <button @click="currentView = 'menu'" class="home-btn mb-0">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
                <button @click="fetchAgents()" class="btn btn-sm btn-ghost text-cyan-400 border border-cyan-500/30 rounded-lg">
                    <span x-show="!loadingAgents">ØªØ­Ø¯ÙŠØ« ğŸ”„</span><span x-show="loadingAgents" class="loading loading-spinner loading-xs"></span>
                </button>
            </div>
            <div class="glass-panel p-6 border-t-4 border-t-cyan-500">
                <h2 class="text-2xl font-black text-white text-center mb-8">Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„ÙˆØ¸ÙŠÙÙŠØ© Ù„Ù„ÙˆÙƒÙ„Ø§Ø¡</h2>
                <div x-show="schoolAgents.length === 0 && !loadingAgents" class="text-center py-10 bg-black/20 rounded-2xl border border-white/5">
                    <span class="text-6xl block mb-4 grayscale">ğŸ‘¥</span>
                    <p class="text-white font-black text-xl mb-2">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆÙƒÙ„Ø§Ø¡ Ù…Ø³Ø¬Ù„ÙŠÙ†!</p>
                    <button @click="currentView = 'agents'" class="btn btn-outline btn-info rounded-xl mt-4">Ø§Ù„Ø°Ù‡Ø§Ø¨ Ù„Ø¥Ø¶Ø§ÙØ© ÙˆÙƒÙŠÙ„ â•</button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4" x-show="schoolAgents.length > 0">
                    <template x-for="(agent, i) in schoolAgents" :key="i + 'rec'">
                        <div class="bg-black/30 p-5 rounded-2xl border border-cyan-500/20 hover:border-cyan-500/50 transition-all">
                            <div class="flex items-center gap-4 mb-4 pb-4 border-b border-white/5">
                                <img :src="agent.avatar_url || 'https://cdn-icons-png.flaticon.com/512/149/149071.png'" class="w-16 h-16 rounded-2xl border-2 border-cyan-500 object-cover bg-white">
                                <div><h3 class="font-black text-white text-lg leading-tight" x-text="agent.full_name || 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ø³ØªÙƒÙ…Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª'"></h3><span class="text-xs font-bold bg-cyan-900/40 text-cyan-400 px-2 py-1 rounded mt-2 inline-block border border-cyan-500/30" x-text="agent.agent_assignment || 'Ø¨Ø¯ÙˆÙ† ØªÙƒÙ„ÙŠÙ'"></span></div>
                            </div>
                            <div class="text-sm space-y-2 text-slate-300 bg-[#0B0F1E] p-4 rounded-xl border border-white/5">
                                <div class="flex justify-between border-b border-white/5 pb-1"><span class="font-bold text-slate-500">Ø§Ù„Ù‚ÙˆÙ…ÙŠ:</span><span class="font-mono text-yellow-300 tracking-widest font-bold" x-text="agent.nid || '---'"></span></div>
                                <div class="flex justify-between border-b border-white/5 pb-1"><span class="font-bold text-slate-500">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ†:</span><span class="text-white" x-text="agent.hiring_date || '---'"></span></div>
                                <div class="flex justify-between border-b border-white/5 pb-1"><span class="font-bold text-slate-500">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¬Ø¯ÙŠØ¯:</span><span class="text-green-400 font-bold" x-text="agent.renewal_date || '---'"></span></div>
                                <div class="flex justify-between pt-1"><span class="font-bold text-slate-500">Ø§Ù„Ù…ÙˆÙ‚Ù Ø§Ù„Ù…Ø§Ù„ÙŠ:</span><span class="text-blue-300 font-bold" x-text="agent.job_status || '---'"></span></div>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </div>

        <div x-show="currentView === 'manager'" x-transition x-cloak>
            <div class="flex justify-between items-center mb-4">
                <button @click="currentView = 'menu'; isEditingForm = false" class="home-btn mb-0">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
                <button @click="printPage()" class="btn btn-sm btn-ghost border border-[#D68C29]/50 text-[#D68C29] rounded-lg">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ø±Ø³Ù…ÙŠ</button>
            </div>
            <div class="glass-panel p-6 border-t-4 border-t-[#D68C29]">
                <div x-show="!isEditingForm">
                    <div class="flex justify-between items-center mb-6 border-b border-white/10 pb-4">
                        <h2 class="text-2xl font-black text-white">Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ Ù„Ù„Ù…Ø¯ÙŠØ±</h2>
                        <button x-show="!isManagerComplete" @click="isEditingForm = true" class="btn btn-sm btn-success text-white border-none rounded-lg animate-pulse">ØªØ³Ø¬ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§ØªÙŠ</button>
                        <button x-show="isManagerComplete" @click="isEditingForm = true" class="btn btn-sm bg-[#D68C29]/20 text-[#D68C29] hover:bg-[#D68C29] hover:text-white border-none rounded-lg">ØªØ¹Ø¯ÙŠÙ„ âœï¸</button>
                    </div>
                    <div class="bg-black/20 p-5 rounded-2xl border border-white/5 space-y-4">
                        <div class="flex items-center gap-4 pb-4 border-b border-white/10">
                            <img :src="managerData.avatar_url || 'https://cdn-icons-png.flaticon.com/512/149/149071.png'" class="w-20 h-20 rounded-2xl border-4 border-[#D68C29] object-cover bg-white shadow-lg">
                            <div>
                                <h3 class="text-xl font-black text-[#F5C678]" x-text="managerData.full_name || 'Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ø¹Ø¯'"></h3>
                                <div class="flex gap-3 items-center mt-2">
                                    <span class="text-slate-400 font-mono text-sm border border-slate-600 px-2 rounded" x-text="managerData.mobile || '---'"></span>
                                    <span class="badge bg-green-600 border-none text-white font-bold rounded-lg" x-text="school.manager_status || 'Ø§Ù„Ù…ÙˆÙ‚Ù ØºÙŠØ± Ù…Ø­Ø¯Ø¯'"></span>
                                </div>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm md:text-base">
                            <div class="bg-[#141A32] p-3 rounded-xl border border-white/5"><span class="text-slate-500 block mb-1 font-bold">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ</span><span class="text-yellow-400 font-mono font-bold tracking-widest" x-text="managerData.nid || '---'"></span></div>
                            <div class="bg-[#141A32] p-3 rounded-xl border border-white/5"><span class="text-slate-500 block mb-1 font-bold">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</span><span class="text-white font-bold" x-text="managerData.dob || '---'"></span></div>
                            <div class="bg-[#141A32] p-3 rounded-xl border border-white/5"><span class="text-slate-500 block mb-1 font-bold">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ†</span><span class="text-white font-bold" x-text="managerData.hiring_date || '---'"></span></div>
                            <div class="bg-[#141A32] p-3 rounded-xl border border-white/5"><span class="text-slate-500 block mb-1 font-bold">Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø¹Ù…Ù„</span><span class="text-white font-bold" x-text="managerData.job_assumption_date || '---'"></span></div>
                        </div>
                    </div>
                </div>

                <div x-show="isEditingForm" x-cloak>
                    <h2 class="text-2xl font-black text-[#F5C678] text-center mb-6">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h2>
                    <div class="mb-6 relative">
                        <div class="avatar-upload-wrapper"><img :src="formData.avatar_url || 'https://cdn-icons-png.flaticon.com/512/149/149071.png'"><div class="avatar-upload-overlay">ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø©</div><input type="file" accept="image/*" @change="uploadAvatar" class="absolute inset-0 opacity-0 cursor-pointer z-10" :disabled="loadingAvatar"></div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="md:col-span-2"><label>Ø§Ù„Ø§Ø³Ù… Ø±Ø¨Ø§Ø¹ÙŠØ§Ù‹</label><input type="text" x-model="formData.full_name" class="input w-full input-light rounded-xl"></div>
                        <div><label>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ</label><input type="tel" x-model="formData.nid" maxlength="14" @input="calculateDates" class="input w-full input-light font-mono text-center rounded-xl"></div>
                        <div><label>Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„</label><input type="tel" x-model="formData.mobile" readonly class="input w-full input-readonly font-mono text-center rounded-xl"></div>
                        <div><label>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ†</label><input type="date" x-model="formData.hiring_date" class="input w-full input-light text-center rounded-xl"></div>
                        <div><label>Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ù‚ÙŠØ§Ø¯ÙŠ</label><input type="date" x-model="formData.job_assumption_date" @change="calculateDates" class="input w-full input-light border-[#D68C29] text-center rounded-xl"></div>
                        <div><label>Ø§Ù„Ù…ÙˆÙ‚Ù Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</label>
                            <select x-model="school.manager_status" class="select w-full input-light font-bold rounded-xl">
                                <option value="" disabled selected>Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆÙ‚Ù...</option><option value="Ù…Ø¹ÙŠÙ† Ø¨Ù‚Ø±Ø§Ø±">Ù…Ø¹ÙŠÙ† Ø¨Ù‚Ø±Ø§Ø±</option><option value="Ù…ÙƒÙ„Ù">Ù…ÙƒÙ„Ù</option>
                            </select>
                        </div>
                        <div class="bg-green-500/5 p-2 rounded-xl"><label class="!text-green-600">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¬Ø¯ÙŠØ¯</label><input type="date" x-model="formData.renewal_date" readonly class="input w-full input-readonly text-green-600 text-center font-black rounded-xl"></div>
                    </div>
                    <div class="flex gap-3 mt-6 pt-4 border-t border-white/10">
                        <button @click="validateAndShowOath" class="btn flex-1 btn-gold text-lg h-14 rounded-xl">Ø­ÙØ¸ ÙˆØ¥Ù†Ù‡Ø§Ø¡ ğŸ’¾</button>
                        <button @click="isEditingForm = false" class="btn bg-slate-700 text-white border-none h-14 rounded-xl px-8">Ø¥Ù„ØºØ§Ø¡</button>
                    </div>
                </div>
            </div>
        </div>

        <div x-show="currentView === 'agent_profile'" x-transition x-cloak>
            <div class="flex justify-between items-center mb-4">
                <button @click="currentView = 'menu'; isEditingForm = false" class="home-btn mb-0">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
                <button @click="printPage()" class="btn btn-sm btn-ghost border border-blue-500/50 text-blue-400 rounded-lg">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø³Ø¬Ù„</button>
            </div>
            <div class="glass-panel p-6 border-t-4 border-t-blue-500">
                <div x-show="!isEditingForm">
                    <div class="flex justify-between items-center mb-6 border-b border-white/10 pb-4">
                        <h2 class="text-2xl font-black text-white">Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ Ù„Ù„ÙˆÙƒÙŠÙ„</h2>
                        <button x-show="!currentUser?.full_name || currentUser?.full_name === 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ø³ØªÙƒÙ…Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª'" @click="isEditingForm = true" class="btn btn-sm btn-success text-white border-none shadow-md animate-pulse rounded-lg">ØªØ³Ø¬ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§ØªÙŠ ğŸ“</button>
                        <button x-show="currentUser?.full_name && currentUser?.full_name !== 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ø³ØªÙƒÙ…Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª'" @click="isEditingForm = true" class="btn btn-sm bg-blue-500/20 text-blue-400 border border-blue-500/50 hover:bg-blue-500 hover:text-white rounded-lg">ØªØ¹Ø¯ÙŠÙ„ âœï¸</button>
                    </div>
                    <div class="bg-black/20 p-5 rounded-2xl border border-white/5 space-y-4">
                        <div class="flex items-center gap-4 pb-4 border-b border-white/10">
                            <img :src="currentUser?.avatar_url || 'https://cdn-icons-png.flaticon.com/512/149/149071.png'" class="w-20 h-20 rounded-2xl border-4 border-blue-500 object-cover bg-white shadow-xl">
                            <div>
                                <h3 class="text-xl font-black text-blue-400" x-text="currentUser?.full_name || 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ³Ø¬ÙŠÙ„'"></h3>
                                <div class="flex gap-2 mt-2">
                                    <span class="badge bg-blue-600 text-white border-none px-3 py-3 rounded-lg font-bold" x-text="currentUser?.agent_assignment || 'Ù„Ù… ÙŠØ­Ø¯Ø¯ Ø§Ù„ØªÙƒÙ„ÙŠÙ'"></span>
                                    <span class="badge bg-green-600 text-white border-none px-3 py-3 rounded-lg font-bold" x-text="currentUser?.job_status || 'Ø§Ù„Ù…ÙˆÙ‚Ù Ø§Ù„Ù…Ø§Ù„ÙŠ ØºÙŠØ± Ù…Ø­Ø¯Ø¯'"></span>
                                </div>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm md:text-base">
                            <div class="bg-[#141A32] p-3 rounded-xl border border-white/5"><span class="text-slate-500 block mb-1 font-bold">Ø§Ù„Ø§Ø³Ù… Ø±Ø¨Ø§Ø¹ÙŠØ§Ù‹</span><span class="text-white font-black" x-text="currentUser?.full_name || '---'"></span></div>
                            <div class="bg-[#141A32] p-3 rounded-xl border border-white/5"><span class="text-slate-500 block mb-1 font-bold">Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„</span><span class="text-white font-mono" x-text="currentUser?.mobile || '---'"></span></div>
                            <div class="bg-[#141A32] p-3 rounded-xl border border-white/5"><span class="text-slate-500 block mb-1 font-bold">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ</span><span class="text-yellow-400 font-mono tracking-widest font-bold" x-text="currentUser?.nid || '---'"></span></div>
                            <div class="bg-[#141A32] p-3 rounded-xl border border-white/5"><span class="text-slate-500 block mb-1 font-bold">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</span><span class="text-white font-bold" x-text="currentUser?.dob || '---'"></span></div>
                            <div class="bg-[#141A32] p-3 rounded-xl border border-white/5"><span class="text-slate-500 block mb-1 font-bold">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ†</span><span class="text-white font-bold" x-text="currentUser?.hiring_date || '---'"></span></div>
                            <div class="bg-[#141A32] p-3 rounded-xl border border-white/5"><span class="text-slate-500 block mb-1 font-bold">Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ</span><span class="text-white font-bold" x-text="currentUser?.job_assumption_date || '---'"></span></div>
                        </div>
                    </div>
                </div>

                <div x-show="isEditingForm" x-cloak>
                    <h2 class="text-2xl font-black text-blue-400 text-center mb-6">ØªØ³Ø¬ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆÙƒÙŠÙ„</h2>
                    <div class="mb-6 relative">
                        <div class="avatar-upload-wrapper !border-blue-500"><img :src="formData.avatar_url || 'https://cdn-icons-png.flaticon.com/512/149/149071.png'"><div class="avatar-upload-overlay">ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø©</div><input type="file" accept="image/*" @change="uploadAvatar" class="absolute inset-0 opacity-0 cursor-pointer z-10" :disabled="loadingAvatar"></div>
                    </div>

                    <div class="bg-black/20 p-6 rounded-3xl border border-white/10 space-y-5">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                            <div class="md:col-span-2">
                                <label class="!text-blue-400">Ø§Ù„ØªÙƒÙ„ÙŠÙ (Ø·Ø¨ÙŠØ¹Ø© Ø§Ù„Ø¹Ù…Ù„)</label>
                                <select x-model="formData.agent_assignment" class="select w-full input-light h-14 rounded-xl text-lg font-bold">
                                    <option value="" disabled selected>Ø§Ø®ØªØ± Ø·Ø¨ÙŠØ¹Ø© Ø§Ù„Ø¹Ù…Ù„...</option><option value="Ø´Ø¦ÙˆÙ† Ø·Ù„Ø§Ø¨">Ø´Ø¦ÙˆÙ† Ø·Ù„Ø§Ø¨</option><option value="Ø´Ø¦ÙˆÙ† Ø¹Ø§Ù…Ù„ÙŠÙ†">Ø´Ø¦ÙˆÙ† Ø¹Ø§Ù…Ù„ÙŠÙ†</option>
                                </select>
                            </div>
                            <div class="md:col-span-2"><label>Ø§Ù„Ø§Ø³Ù… Ø±Ø¨Ø§Ø¹ÙŠØ§Ù‹ (Ø¥Ø¬Ø¨Ø§Ø±ÙŠ)</label><input type="text" x-model="formData.full_name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„ ÙˆØ§Ù„Ø«Ø§Ù†ÙŠ ÙˆØ§Ù„Ø«Ø§Ù„Ø« ÙˆØ§Ù„Ù„Ù‚Ø¨" class="input w-full input-light h-14 rounded-xl text-lg"></div>
                            <div><label>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ (14 Ø±Ù‚Ù…)</label><input type="tel" x-model="formData.nid" maxlength="14" @input="calculateDates" class="input w-full input-light h-14 rounded-xl text-center font-mono text-lg tracking-widest"></div>
                            <div><label>Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„</label><input type="tel" x-model="formData.mobile" readonly class="input w-full input-readonly h-14 rounded-xl text-center font-mono text-lg"></div>
                            <div><label>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£ÙˆÙ„</label><input type="date" x-model="formData.hiring_date" class="input w-full input-light h-14 rounded-xl text-center"></div>
                            <div><label>Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ</label><input type="date" x-model="formData.job_assumption_date" @change="calculateDates" class="input w-full input-light border-blue-500 h-14 rounded-xl text-center"></div>
                            <div><label>Ø§Ù„Ù…ÙˆÙ‚Ù Ø§Ù„Ù…Ø§Ù„ÙŠ</label>
                                <select x-model="formData.job_status" class="select w-full input-light h-14 rounded-xl font-bold">
                                    <option value="" disabled selected>Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆÙ‚Ù...</option><option value="Ù…Ø¹ÙŠÙ† Ø¨Ù‚Ø±Ø§Ø±">Ù…Ø¹ÙŠÙ† Ø¨Ù‚Ø±Ø§Ø±</option><option value="Ù…ÙƒÙ„Ù">Ù…ÙƒÙ„Ù</option>
                                </select>
                            </div>
                            <div class="bg-green-500/5 p-2 rounded-xl"><label class="!text-green-600">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¬Ø¯ÙŠØ¯ (ØªÙ„Ù‚Ø§Ø¦ÙŠ)</label><input type="date" x-model="formData.renewal_date" readonly class="input w-full input-readonly text-green-600 h-10 text-center font-black rounded-lg"></div>
                        </div>
                        <div class="flex gap-3 mt-8 pt-6 border-t border-white/10">
                            <button @click="validateAndShowOath" class="btn flex-1 bg-blue-600 hover:bg-blue-700 text-white h-14 rounded-xl text-xl font-black border-none">Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§ØªÙŠ ğŸ’¾</button>
                            <button @click="isEditingForm = false" class="btn bg-slate-700 text-white h-14 rounded-xl border-none px-8">Ø¥Ù„ØºØ§Ø¡</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div x-show="currentView === 'agents'" x-transition x-cloak>
            <div class="flex justify-between items-center mb-4"><button @click="currentView = 'menu'" class="home-btn mb-0">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button><button @click="fetchAgents()" class="btn btn-sm btn-ghost text-blue-400 border border-blue-500/30 rounded-lg"><span x-show="!loadingAgents">ğŸ”„ ØªØ­Ø¯ÙŠØ«</span><span x-show="loadingAgents" class="loading loading-spinner loading-xs"></span></button></div>
            <div class="glass-panel p-6 border-t-4 border-t-blue-500">
                <h2 class="text-2xl font-black text-white text-center mb-6">âš™ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡</h2>
                <div class="bg-black/30 p-5 rounded-2xl border border-white/10 mb-8">
                    <label class="mb-2 block text-[#D68C29] text-sm font-bold">Ø¥Ø¶Ø§ÙØ© ÙˆÙƒÙŠÙ„ Ø¨Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„</label>
                    <div class="flex gap-3"><input type="tel" x-model="newAgentMobile" maxlength="11" class="input w-full input-light rounded-xl font-mono"><button @click="addNewAgent()" class="btn btn-success text-white rounded-xl">Ø¥Ø¶Ø§ÙØ©</button></div>
                </div>
                <div class="space-y-4">
                    <template x-for="(agent, i) in schoolAgents" :key="i + 'mgmt'">
                        <div class="bg-gradient-to-l from-slate-800 to-[#141A32] p-4 rounded-2xl border border-white/10 flex justify-between items-center">
                            <div class="flex items-center gap-4"><img :src="agent.avatar_url || 'https://cdn-icons-png.flaticon.com/512/149/149071.png'" class="w-10 h-10 rounded-xl object-cover bg-white"><div><h3 class="font-bold text-white" x-text="agent.full_name || 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ³Ø¬ÙŠÙ„'"></h3><p class="text-blue-300 font-mono text-xs" x-text="agent.mobile"></p></div></div>
                            <button @click="removeAgent(agent.mobile)" class="btn btn-sm btn-error text-white rounded-lg">Ø¥Ø²Ø§Ù„Ø© ğŸ—‘ï¸</button>
                        </div>
                    </template>
                </div>
            </div>
        </div>

        <div x-show="currentView === 'messages'" x-transition x-cloak>
            <button @click="currentView = 'menu'" class="home-btn">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
            <div class="glass-panel p-6 border-t-4 border-t-purple-500"><h2 class="text-2xl font-black text-white text-center mb-6">âœ‰ï¸ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª ÙˆØ§Ù„Ù†Ø´Ø±Ø§Øª</h2><div class="space-y-4 max-h-[60vh] overflow-y-auto custom-scrollbar pr-2"><template x-for="msg in schoolMessages" :key="msg.id"><div class="bg-black/30 p-5 rounded-2xl border border-purple-500/30"><div class="flex justify-between items-center border-b border-white/10 pb-2 mb-3"><span :class="`badge text-white font-bold border-none rounded-lg px-3 ${msg.school_id ? 'bg-blue-600' : 'bg-purple-600'}`" x-text="msg.school_id ? 'Ø±Ø³Ø§Ù„Ø© Ø®Ø§ØµØ© Ø¨Ù…Ø¯Ø±Ø³ØªÙƒ' : 'ØªØ¹Ù…ÙŠÙ… Ø¥Ø¯Ø§Ø±ÙŠ'"></span><span class="text-xs text-slate-400 font-bold" x-text="new Date(msg.created_at).toLocaleDateString('ar-EG')"></span></div><p class="text-white text-sm whitespace-pre-wrap leading-loose" x-text="msg.message"></p><template x-if="msg.file_url"><div class="mt-4 pt-3 border-t border-white/5"><a :href="msg.file_url" target="_blank" class="btn btn-sm bg-purple-600/20 text-purple-300 border-none rounded-lg">Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø±ÙÙ‚ Ø§Ù„Ø±Ø³Ù…ÙŠ ğŸ“</a></div></template></div></template><div x-show="schoolMessages.length === 0" class="text-center text-slate-500 py-10 font-bold">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„.</div></div></div>
        </div>

        <div x-show="currentView === 'requests'" x-transition x-cloak>
            <button @click="currentView = 'menu'" class="home-btn">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
            <div class="glass-panel p-6 border-t-4 border-t-[#F5C678]"><h2 class="text-2xl font-black text-white text-center mb-6">ğŸ“¤ Ø±ÙØ¹ Ø§Ù„Ø¥Ù‚Ø±Ø§Ø±Ø§Øª ÙˆØ§Ù„Ø·Ù„Ø¨Ø§Øª</h2><div class="space-y-4 bg-black/20 p-6 rounded-3xl border border-white/10"><label class="text-[#D68C29] block font-bold">Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨ / Ø§Ù„Ø¥Ù‚Ø±Ø§Ø±</label><textarea x-model="requestForm.statement" class="textarea w-full input-light h-32 rounded-xl text-lg" placeholder="Ø§ÙƒØªØ¨ ØªÙØ§ØµÙŠÙ„ Ø·Ù„Ø¨Ùƒ Ù‡Ù†Ø§..."></textarea><label class="text-[#D68C29] block font-bold mt-4">Ø¥Ø±ÙØ§Ù‚ Ø§Ù„Ù…Ø³ØªÙ†Ø¯ (ØµÙˆØ±Ø© Ø£Ùˆ PDF)</label><input type="file" @change="e => requestForm.file = e.target.files[0]" class="file-input file-input-bordered w-full bg-white text-black h-14 rounded-xl"><button @click="submitRequest" class="btn w-full btn-gold h-14 text-xl font-black mt-6 rounded-xl shadow-lg">Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„ØªÙ†Ø³ÙŠÙ‚ ğŸš€</button></div></div>
        </div>

    </div>

    <div id="printArea" class="hidden print:block absolute top-0 left-0 w-full bg-white text-black p-8" style="direction: rtl;">
        <div style="display: flex; justify-content: space-between; border-bottom: 3px solid black; padding-bottom: 10px; margin-bottom: 20px;">
            <div style="text-align: right; line-height: 1.5; font-weight: bold; font-size: 16px;"><p>Ù…Ø­Ø§ÙØ¸Ø© Ø³ÙˆÙ‡Ø§Ø¬</p><p>Ù…Ø¯ÙŠØ±ÙŠØ© Ø§Ù„ØªØ±Ø¨ÙŠØ© ÙˆØ§Ù„ØªØ¹Ù„ÙŠÙ…</p><p>Ø¥Ø¯Ø§Ø±Ø© Ø³ÙˆÙ‡Ø§Ø¬ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</p></div>
            <div style="text-align: center;"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a6/Coat_of_arms_of_Egypt_%28Official%29.svg/120px-Coat_of_arms_of_Egypt_%28Official%29.svg.png" style="width: 80px;"></div>
            <div style="text-align: left; line-height: 1.5; font-weight: bold; font-size: 16px;"><p>ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ ÙˆØ§Ù„Ø«Ø§Ù†ÙˆÙŠ</p><p>Ù…Ø¯Ø±Ø³Ø©: <span x-text="school.name"></span></p><p>Ø§Ù„ØªØ§Ø±ÙŠØ®: <span x-text="new Date().toLocaleDateString('ar-EG')"></span></p></div>
        </div>
        <h2 style="text-align: center; font-size: 24px; font-weight: bold; text-decoration: underline; margin-bottom: 30px;">ØµØ­ÙŠÙØ© Ø£Ø­ÙˆØ§Ù„ ÙˆØªØ´ÙƒÙŠÙ„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</h2>
        <div style="margin-bottom: 30px;">
            <h3 style="background: #eee; padding: 8px; border: 1px solid black; font-weight: bold;">Ø£ÙˆÙ„Ø§Ù‹: Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙŠØ¯/Ø© Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</h3>
            <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                <tr><th class="print-border" style="width: 20%; background: #f9f9f9; text-align: right;">Ø§Ù„Ø§Ø³Ù… Ø±Ø¨Ø§Ø¹ÙŠ</th><td class="print-border" colspan="3" font-weight="bold" x-text="managerData.full_name || 'ØºÙŠØ± Ù…Ø³Ø¬Ù„'"></td></tr>
                <tr><th class="print-border" style="background: #f9f9f9; text-align: right;">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ</th><td class="print-border" style="font-family: monospace;" x-text="managerData.nid || '---'"></td><th class="print-border" style="background: #f9f9f9; text-align: right;">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</th><td class="print-border" x-text="managerData.dob || '---'"></td></tr>
                <tr><th class="print-border" style="background: #f9f9f9; text-align: right;">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ†</th><td class="print-border" x-text="managerData.hiring_date || '---'"></td><th class="print-border" style="background: #f9f9f9; text-align: right;">Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø¹Ù…Ù„</th><td class="print-border" x-text="managerData.job_assumption_date || '---'"></td></tr>
                <tr><th class="print-border" style="background: #f9f9f9; text-align: right;">Ø§Ù„Ù…ÙˆÙ‚Ù Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</th><td class="print-border" font-weight="bold" x-text="school.manager_status || '---'"></td><th class="print-border" style="background: #f9f9f9; text-align: right;">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¬Ø¯ÙŠØ¯</th><td class="print-border" x-text="managerData.renewal_date || '---'"></td></tr>
            </table>
        </div>
        <div>
            <h3 style="background: #eee; padding: 8px; border: 1px solid black; font-weight: bold;">Ø«Ø§Ù†ÙŠØ§Ù‹: Ø·Ø§Ù‚Ù… Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡ Ø¨Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</h3>
            <table style="width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 14px; text-align: center;">
                <thead><tr style="background: #f9f9f9;"><th class="print-border">Ù…</th><th class="print-border">Ø§Ù„Ø§Ø³Ù… Ø±Ø¨Ø§Ø¹ÙŠ</th><th class="print-border">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ</th><th class="print-border">Ø§Ù„ØªÙƒÙ„ÙŠÙ</th><th class="print-border">Ø§Ù„Ù…ÙˆÙ‚Ù Ø§Ù„Ù…Ø§Ù„ÙŠ</th><th class="print-border">Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø¹Ù…Ù„</th><th class="print-border">Ø§Ù„ØªØ¬Ø¯ÙŠØ¯</th></tr></thead>
                <tbody>
                    <template x-for="(agent, idx) in schoolAgents" :key="idx + 'p'">
                        <tr><td class="print-border" x-text="idx + 1"></td><td class="print-border" style="text-align: right; font-weight: bold;" x-text="agent.full_name || 'ØºÙŠØ± Ù…Ø³Ø¬Ù„'"></td><td class="print-border" style="font-family: monospace;" x-text="agent.nid || '---'"></td><td class="print-border" x-text="agent.agent_assignment || '---'"></td><td class="print-border" x-text="agent.job_status || '---'"></td><td class="print-border" x-text="agent.job_assumption_date || '---'"></td><td class="print-border" x-text="agent.renewal_date || '---'"></td></tr>
                    </template>
                </tbody>
            </table>
        </div>
        <div style="margin-top: 60px; display: flex; justify-content: space-between; text-align: center; font-weight: bold; font-size: 16px;">
            <div><p>ØªÙˆÙ‚ÙŠØ¹ Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</p><p style="margin-top: 40px;">.......................................</p></div>
            <div><p>Ø®Ø§ØªÙ… Ø´Ø¹Ø§Ø± Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© (Ø§Ù„Ù…Ø¯Ø±Ø³Ø©)</p><div style="width: 80px; height: 80px; border-radius: 50%; border: 2px dashed #999; margin: 15px auto;"></div></div>
            <div><p>ÙŠØ¹ØªÙ…Ø¯ ØŒØŒØŒ Ù…Ø¯ÙŠØ± Ø¹Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</p><p style="margin-top: 40px;">.......................................</p></div>
        </div>
    </div>

    <script>
        function madrasaApp() {
            const client = supabase.createClient('https://zjvnppqygcpccbtgebbq.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inpqdm5wcHF5Z2NwY2NidGdlYmJxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE0MTE1MjgsImV4cCI6MjA4Njk4NzUyOH0.LnUKMQkfh4YWMvUxO11wAw5ZY_k52PGAeVMVOky_ts0');
            
            const defaultSubjectsStats = {
                arabic: { name: 'Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©', original: '', delegated: '', session: '', surplus: '', deficit: '' },
                english: { name: 'Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©', original: '', delegated: '', session: '', surplus: '', deficit: '' },
                social: { name: 'Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©', original: '', delegated: '', session: '', surplus: '', deficit: '' },
                math: { name: 'Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª', original: '', delegated: '', session: '', surplus: '', deficit: '' },
                science: { name: 'Ø§Ù„Ø¹Ù„ÙˆÙ…', original: '', delegated: '', session: '', surplus: '', deficit: '' }
            };

            return {
                currentView: 'menu', isEditingForm: false, showOathModal: false, loading: false, sendingReport: false, loadingAvatar: false, loadingAgents: false,
                currentUser: null, managerData: {}, school: { manager_status: '', teachers_count: '', admins_count: '', workers_count: '', students_count: '', female_students_count: '', classrooms_count: '', subjects_stats: defaultSubjectsStats }, 
                schoolAgents: [], formData: {}, newAgentMobile: '', requestForm: { statement: '', file: null },
                schoolMessages: [], requests: [],
                isLightMode: localStorage.getItem('theme') === 'light',
                staffChart: null, studentChart: null,
                alertModal: { show: false, type: 'success', title: '', message: '' }, showAlert(title, message, type = 'success') { this.alertModal = { show: true, type, title, message }; }, closeAlert() { this.alertModal.show = false; },

                get isManagerComplete() { return this.managerData && this.managerData.full_name && !this.managerData.full_name.includes('Ø¨Ø§Ù†ØªØ¸Ø§Ø±') && this.managerData.nid && this.managerData.avatar_url; },
                get isAgentsComplete() { return this.schoolAgents && this.schoolAgents.length > 0 && this.schoolAgents.every(a => a.full_name && !a.full_name.includes('Ø¨Ø§Ù†ØªØ¸Ø§Ø±')); },
                get isTeachersComplete() { return this.school && this.school.subjects_stats && Object.values(this.school.subjects_stats).some(s => Number(s.original) > 0 || Number(s.delegated) > 0 || Number(s.session) > 0 || Number(s.deficit) > 0 || Number(s.surplus) > 0); },
                get isStatsComplete() { return this.school && this.school.manager_status && this.school.manager_status !== ''; },
                get progressPercentage() { let c = 0; if (this.isManagerComplete) c++; if (this.isAgentsComplete) c++; if (this.isTeachersComplete) c++; if (this.isStatsComplete) c++; return (c / 4) * 100; },
                get progressLine() { let c = 0; if (this.isManagerComplete) c++; if (this.isAgentsComplete) c++; if (this.isTeachersComplete) c++; if (this.isStatsComplete) c++; if (c === 0) return 0; if (c === 1) return 25; if (c === 2) return 50; if (c === 3) return 75; return 100; },

                async initApp() {
                    if (this.isLightMode) document.body.classList.add('light-theme');
                    const uid = new URLSearchParams(window.location.search).get('uid');
                    if (!uid) return window.location.href = 'login.html';
                    
                    let { data: user } = await client.from('users').select('*, schools(*)').eq('mobile', uid).single();
                    if (!user) { localStorage.removeItem('login_mobile'); return window.location.href = 'login.html'; }

                    this.currentUser = user; this.school = user.schools || {};
                    ['teachers_count', 'admins_count', 'workers_count', 'students_count', 'female_students_count', 'classrooms_count'].forEach(k => { if(this.school[k] === undefined || this.school[k] === null || this.school[k] === 0) this.school[k] = ''; });
                    
                    if (typeof this.school.subjects_stats === 'object' && this.school.subjects_stats !== null && Object.keys(this.school.subjects_stats).length > 0) {
                        // Data exists
                    } else {
                        this.school.subjects_stats = JSON.parse(JSON.stringify(defaultSubjectsStats));
                    }
                    
                    let { data: mgr } = await client.from('users').select('*').eq('school_id', this.school.id).eq('role', 'manager').maybeSingle();
                    this.managerData = mgr || {};
                    
                    this.fetchAgents(); this.fetchSchoolMessages(); this.fetchRequests();
                },

                toggleTheme() {
                    this.isLightMode = !this.isLightMode; localStorage.setItem('theme', this.isLightMode ? 'light' : 'dark');
                    if (this.isLightMode) document.body.classList.add('light-theme'); else document.body.classList.remove('light-theme');
                    if (this.currentView === 'statistics') setTimeout(() => this.renderCharts(), 100);
                },

                printPage() { window.print(); },

                debouncedRenderCharts() {
                    clearTimeout(this.chartTimeout);
                    this.chartTimeout = setTimeout(() => {
                        this.renderCharts();
                    }, 300);
                },

                renderCharts() {
                    const isDark = !this.isLightMode; const textColor = isDark ? '#E8EDEB' : '#0f172a';
                    const ctxStaff = document.getElementById('staffChart');
                    const ctxStudent = document.getElementById('studentChart');
                    
                    if(!ctxStaff || !ctxStudent) return; 

                    if(this.staffChart) this.staffChart.destroy(); if(this.studentChart) this.studentChart.destroy();

                    this.staffChart = new Chart(ctxStaff, { type: 'doughnut', data: { labels: ['Ù…Ø¹Ù„Ù…ÙŠÙ†', 'Ø¥Ø¯Ø§Ø±ÙŠÙŠÙ†', 'Ø¹Ù…Ø§Ù„'], datasets: [{ data: [this.school.teachers_count||0, this.school.admins_count||0, this.school.workers_count||0], backgroundColor: ['#818cf8', '#2dd4bf', '#fbbf24'], borderWidth: isDark? 0: 2 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { color: textColor, font: { family: 'Cairo' } } } }, cutout: '60%' } });

                    this.studentChart = new Chart(ctxStudent, { type: 'pie', data: { labels: ['Ø¨Ù†ÙŠÙ†', 'Ø¨Ù†Ø§Øª'], datasets: [{ data: [this.school.students_count||0, this.school.female_students_count||0], backgroundColor: ['#60a5fa', '#f472b6'], borderWidth: isDark? 0: 2 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { color: textColor, font: { family: 'Cairo' } } } } } });
                },

                async fetchSchoolMessages() { const { data } = await client.from('messages').select('*').or(`school_id.is.null,school_id.eq.${this.school.id}`).order('created_at', { ascending: false }); this.schoolMessages = data || []; },
                async fetchRequests() { const { data } = await client.from('coordination_requests').select('*').eq('school_id', this.school.id); this.requests = data || []; },

                async fetchAgents() { 
                    this.loadingAgents = true; const s_id = this.currentUser?.school_id; if (!s_id) { this.loadingAgents = false; return; }
                    try { const { data, error } = await client.from('users').select('*').eq('school_id', s_id).eq('role', 'agent'); if (error) throw error; this.schoolAgents = data || []; } catch (err) { this.schoolAgents = []; } finally { this.loadingAgents = false; }
                },
                
                openManagerView() { this.currentView = 'manager'; this.isEditingForm = false; this.formData = { ...this.managerData }; if(!this.formData.mobile) this.formData.mobile = this.currentUser.mobile; },
                openAgentProfile() { this.currentView = 'agent_profile'; this.formData = { ...this.currentUser }; if (!this.currentUser.full_name || this.currentUser.full_name === 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ø³ØªÙƒÙ…Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª') { this.formData.full_name = ''; this.isEditingForm = true; } else { this.isEditingForm = false; } },
                openStatistics() { this.currentView = 'statistics'; setTimeout(() => { this.renderCharts(); }, 200); },

                calculateDates() { 
                    let nid = this.formData.nid; 
                    if (nid && nid.length === 14) { let y = parseInt((nid[0] === '2' ? '19' : '20') + nid.substring(1, 3)), m = nid.substring(3, 5), d = nid.substring(5, 7); this.formData.dob = `${y}-${m}-${d}`; this.formData.retirement_date = `${y + 60}-${m}-${d}`; } 
                    if (this.formData.job_assumption_date) { let date = new Date(this.formData.job_assumption_date); date.setFullYear(date.getFullYear() + 2); this.formData.renewal_date = date.toISOString().split('T')[0]; } 
                },

                async uploadAvatar(e) {
                    const file = e.target.files[0]; if(!file) return; this.loadingAvatar = true;
                    try {
                        const fileName = `${Date.now()}_avatar_${this.currentUser.mobile}.${file.name.split('.').pop()}`;
                        const { error: uploadError } = await client.storage.from('avatars').upload(fileName, file); if(uploadError) throw uploadError;
                        const { data } = client.storage.from('avatars').getPublicUrl(fileName);
                        await client.from('users').update({ avatar_url: data.publicUrl }).eq('mobile', this.currentUser.mobile);
                        this.currentUser.avatar_url = data.publicUrl;
                        if(this.currentUser.role === 'manager') this.managerData.avatar_url = data.publicUrl; else this.fetchAgents();
                        this.formData.avatar_url = data.publicUrl; this.showAlert('Ù†Ø¬Ø§Ø­ âœ…', 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙˆØ±Ø©', 'success');
                    } catch(err) { this.showAlert('Ø®Ø·Ø£', 'ÙØ´Ù„ Ø§Ù„Ø±ÙØ¹', 'error'); } finally { this.loadingAvatar = false; }
                },

                validateAndShowOath() {
                    if (!this.formData.avatar_url) return this.showAlert('Ù…ÙÙ‚ÙˆØ¯', 'Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ© Ø¥Ù„Ø²Ø§Ù…ÙŠØ©.', 'error');
                    const nameParts = (this.formData.full_name || '').trim().split(/\s+/); if (nameParts.length < 4) return this.showAlert('Ø®Ø·Ø£', 'ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… Ø±Ø¨Ø§Ø¹ÙŠØ§Ù‹.', 'error');
                    const nid = (this.formData.nid || '').trim(); if (nid.length !== 14 || isNaN(nid)) return this.showAlert('Ø®Ø·Ø£', 'Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ 14 Ø±Ù‚Ù….', 'error');
                    this.showOathModal = true;
                },

                async confirmAndSave() {
                    this.showOathModal = false; this.loading = true;
                    const payload = { full_name: this.formData.full_name, nid: this.formData.nid, dob: this.formData.dob || null, hiring_date: this.formData.hiring_date || null, job_assumption_date: this.formData.job_assumption_date || null, retirement_date: this.formData.retirement_date || null, renewal_date: this.formData.renewal_date || null, agent_assignment: this.formData.agent_assignment || null, job_status: this.formData.job_status || null };
                    const { error } = await client.from('users').update(payload).eq('mobile', this.currentUser.mobile);
                    if (error) { this.loading = false; return this.showAlert('Ø®Ø·Ø£', 'ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸', 'error'); }
                    if (this.currentUser.role === 'manager') { await client.from('schools').update({ manager_status: this.school.manager_status }).eq('id', this.school.id); }
                    this.currentUser = { ...this.currentUser, ...payload };
                    if(this.currentUser.role === 'manager') { this.managerData = { ...this.currentUser }; } else { await this.fetchAgents(); }
                    this.loading = false; this.isEditingForm = false; this.showAlert('ØªÙ… âœ…', 'ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­.', 'success');
                },

                async addNewAgent() { 
                    if (!this.newAgentMobile || this.newAgentMobile.length !== 11) return this.showAlert('Ø®Ø·Ø£', 'Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… 11 Ø±Ù‚Ù….', 'error');
                    this.loadingAgents = true; const s_id = this.currentUser.school_id;
                    const newObj = { mobile: this.newAgentMobile, school_id: s_id, role: 'agent', pin: '0000', full_name: 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ø³ØªÙƒÙ…Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª' };
                    const { error } = await client.from('users').insert([newObj]); 
                    if (error) { this.loadingAgents = false; return this.showAlert('Ø®Ø·Ø£', 'Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹', 'error'); }
                    this.schoolAgents = [...this.schoolAgents, newObj]; this.newAgentMobile = ''; this.loadingAgents = false; this.showAlert('ØªÙ… âœ…', 'ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙˆÙƒÙŠÙ„.', 'success'); 
                },
                
                async removeAgent(mobile) { if (!confirm('ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°ÙØŸ')) return; this.schoolAgents = this.schoolAgents.filter(a => a.mobile !== mobile); await client.from('users').delete().eq('mobile', mobile); },

                async submitRequest() {
                    if (!this.requestForm.statement) return this.showAlert('ØªÙ†Ø¨ÙŠÙ‡', 'ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø·Ù„Ø¨', 'error');
                    this.loading = true; let fileUrl = null;
                    try {
                        if (this.requestForm.file) { const file = this.requestForm.file; const fileName = `${Date.now()}_doc_${this.school.id}.${file.name.split('.').pop()}`; await client.storage.from('requests_files').upload(fileName, file); fileUrl = client.storage.from('requests_files').getPublicUrl(fileName).data.publicUrl; }
                        await client.from('coordination_requests').insert([{ school_id: this.school.id, statement: this.requestForm.statement, file_url: fileUrl }]);
                        this.showAlert('ØªÙ…', 'ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨! ğŸš€', 'success'); this.requestForm.statement = ''; this.requestForm.file = null; this.fetchRequests(); setTimeout(() => { this.currentView = 'menu'; }, 2000);
                    } catch (err) { this.showAlert('Ø®Ø·Ø£', 'ÙØ´Ù„ Ø§Ù„Ø±ÙØ¹', 'error'); } finally { this.loading = false; }
                },

                async saveSubjectsStats() {
                    this.loading = true;
                    try {
                        const { error } = await client.from('schools').update({ subjects_stats: this.school.subjects_stats }).eq('id', this.school.id);
                        if (error) throw error;
                        this.showAlert('ØªÙ… Ø§Ù„Ø­ÙØ¸', 'ØªÙ… Ø­ÙØ¸ Ø¥Ø­ØµØ§Ø¡ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­ ğŸ’¾', 'success');
                    } catch (err) { this.showAlert('Ø®Ø·Ø£', 'ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙˆØ¯ subjects_stats ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error'); } finally { this.loading = false; }
                },

                async exportStatsToAdmin() {
                    if (!this.school.manager_status && this.currentUser.role === 'manager') return this.showAlert('ØªÙ†Ø¨ÙŠÙ‡', 'ÙŠØ¬Ø¨ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ù Ø§Ù„ÙˆØ¸ÙŠÙÙŠ Ù„Ù„Ù…Ø¯ÙŠØ±', 'error');
                    this.sendingReport = true;
                    try {
                        await client.from('schools').update({ 
                            teachers_count: this.school.teachers_count || 0, admins_count: this.school.admins_count || 0, workers_count: this.school.workers_count || 0, classrooms_count: this.school.classrooms_count || 0, students_count: this.school.students_count || 0, female_students_count: this.school.female_students_count || 0, manager_status: this.school.manager_status,
                            subjects_stats: this.school.subjects_stats
                        }).eq('id', this.school.id);
                        
                        let agentsText = '';
                        if (this.schoolAgents.length > 0) { this.schoolAgents.forEach((a, i) => { agentsText += `ğŸ‘¨â€ğŸ« Ø§Ù„ÙˆÙƒÙŠÙ„ ${i + 1} (${a.agent_assignment || 'Ø¨Ø¯ÙˆÙ†'}): [${a.job_status || 'Ù„Ù… ÙŠØ­Ø¯Ø¯'}] - ${a.full_name || 'ØºÙŠØ± Ù…Ø³Ø¬Ù„'}\n`; }); } else { agentsText = 'ğŸ‘¨â€ğŸ« Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆÙƒÙ„Ø§Ø¡.\n'; }
                        
                        let subjectsText = '-----------------------------------------\nğŸ“š Ø¥Ø­ØµØ§Ø¡ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©:\n';
                        const orderedKeys = ['arabic', 'english', 'social', 'math', 'science'];
                        for (const key of orderedKeys) {
                            let s = this.school.subjects_stats[key];
                            if(s) { subjectsText += `â–ªï¸ ${s.name}: Ø£ØµÙ„ÙŠ(${s.original||0}) | Ù…Ù†ØªØ¯Ø¨(${s.delegated||0}) | Ø¨Ø§Ù„Ø­ØµØ©(${s.session||0}) | ğŸ”´ Ø¹Ø¬Ø²(${s.deficit||0}) | ğŸŸ¢ Ø²ÙŠØ§Ø¯Ø©(${s.surplus||0})\n`; }
                        }

                        const reportText = `ğŸ“Š Ø¥Ø­ØµØ§Ø¡ Ø§Ù„Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø´Ø§Ù…Ù„\n-----------------------------------------\nğŸ« Ù…Ø¯Ø±Ø³Ø©: ${this.school.name}\n-----------------------------------------\nğŸ‘¨â€ğŸ’¼ Ø§Ù„Ù…Ø¯ÙŠØ±: [${this.school.manager_status}] - ${this.managerData.full_name || 'ØºÙŠØ± Ù…Ø³Ø¬Ù„'}\n${agentsText}\n-----------------------------------------\nğŸ‘¥ Ù‚ÙˆØ© Ø§Ù„Ø¹Ù…Ù„:\nğŸ‘¨â€ğŸ« Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†: ${this.school.teachers_count || 0} | ğŸ‘¨â€ğŸ’» Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠÙŠÙ†: ${this.school.admins_count || 0} | ğŸ§¹ Ø§Ù„Ø¹Ù…Ø§Ù„: ${this.school.workers_count || 0}\n-----------------------------------------\nğŸ“ Ø£Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆØ§Ù„ÙØµÙˆÙ„:\nğŸ‘¦ Ø§Ù„Ø¨Ù†ÙŠÙ†: ${this.school.students_count || 0} | ğŸ‘§ Ø§Ù„Ø¨Ù†Ø§Øª: ${this.school.female_students_count || 0} | ğŸšª Ø§Ù„ÙØµÙˆÙ„: ${this.school.classrooms_count || 0}\n${subjectsText}`;
                        
                        await client.from('coordination_requests').insert([{ school_id: this.school.id, statement: reportText }]);
                        this.showAlert('ØªÙ… Ø¨Ù†Ø¬Ø§Ø­ âœ…', 'ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø­ØµØ§Ø¡ Ø¥Ù„Ù‰ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚.', 'success');
                    } catch (err) { this.showAlert('Ø®Ø·Ø£', 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø¨Ø§Ù„ØªØµØ¯ÙŠØ±.', 'error'); }
                    this.sendingReport = false;
                },

                logout() { localStorage.clear(); window.location.href = 'login.html'; }
            }
        }
    </script>
</body>
</html>
